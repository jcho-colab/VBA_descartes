# Overview
I have a very complex excel file that contains macros. This is related on FTA tarif rates for which Descartes send us xml files. We maintain our system with the latest information from them.
Only chapters 25 and above are considered.
In this example, the country is set to NZ.
It has several buttons on the main page to launch the macros, several tabs that are populated by these macros, there is a mapping also with XML files (under developer tab -> source) , many tables that are called during the macros, and more. Based on the xml that are downloaded (see input XML folder), tabs are populated, and several files are generated and saved (see output CSV folder). I want to recreate the whole thing using python because it will be more flexible and easier to maintain. 
Refer to map.xml in the folder. The code for the macros are in the Macro VBA folder.
The goal is to recreate the exact same output (CSV files) as the excel version but with python and a modern interface, also considering the size (100k rows max). With python, there might be a way to achieve the same goal faster, with a better logic, and more reliable. Excel has constraints and some steps in the macros may not be needed with python. So you need to skip these steps, as long as the results are the same.
To help you, you can scan the input xml files, the macros code, the output csv files, and the main excel file, called HS_IMP_v6.3.xlsm.

# steps in Menu tab
there are 3 kind of XML, ones that have DTR in the name, ones that have NOM, and ones that have TXT.
Typically, on the first tab 'Menu', a user will click on a button to import the DTR xml files first and clean them (associated macros are 
- HS_IMP_v6.3.xlsm!ImportXMLDTR
- HS_IMP_v6.3.xlsm!DataCleansingDTR
).

He would do the same with the NOM files, associated macros are HS_IMP_v6.3.xlsm!ImportXmlNOM and
HS_IMP_v6.3.xlsm!DataCleansingNOM

Then, import the TXT file with this macro
HS_IMP_v6.3.xlsm!ImportXMLTXT

And finally, use this macro.
HS_IMP_v6.3.xlsm!GenerateOutput

There is also a button called Execute ALL, associated with this macro: HS_IMP_v6.3.xlsm!ExecuteAll, that can be used when all 3 kind of xml files are imported.

Some parameters are also chosen in F6 to F11 (some have formulas).

# tab Config
This tab contains many tables, related to a specific country. Look at Austrlia for example.
Some FTA are applicables (marked as keep), some are not (marked as removed), and 1 is marked as '3rd' whick seems to be the main one to use (maybe you can validate).

# Current UI
A user chooses a country, and select the xml files in a window. A message confirms how many xml of each group is imported.
When imported, the TAB DTR is populated with the DTR xml files (same with NOM tab and NOM files).
The macros associated with the cleaning will perform a some operations in this DTR and NOM tabs.
The tab Definitions is also populated with the xml import.
Then the user click on GenerateOutput (macro HS_IMP_v6.3.xlsm!GenerateOutput ) and depending on the countries, the tabs ZD14, CAPDR, MX6Digits, ZZDE, ZZDF are populated. For each of these 5 tabs, there is a macro that allows to create and export the output CSV files needed.
ZD14, macro is HS_IMP_v6.3.xlsm!ExportZD14
CAPDR, macro is HS_IMP_v6.3.xlsm!ExportCAPDR
MX6Digits, macro is HS_IMP_v6.3.xlsm!ExportMX6Digits
ZZDE, macro is HS_IMP_v6.3.xlsm!ExportZZDE
ZZDFmacro is HS_IMP_v6.3.xlsm!ExportZZDE


# the solution I need.
Use python and a friendly user interface that any user could start from their own laptop (streamlit maybe?)
Some steps described above can probably be performed in the background with python, without the need to create a specific dataframe to hold the information.
a user choose a country, then drag and drop the xml files in a windows.
He confirms the creation of the output csv files and is prompted to choose a folder to save them.

# Validation
Ensure that for all the specific tables in excel, you have access to them, as they will be called in the VBA code. If not, i will add more instructions.
Extract the xml mapping if needed.
Determine, from the vba code,  how the csv output files are truncated into several files and do the same.
To compare the generated output with the source output in the output folder, you need to generate the same number of files and compare the data.
Adjust the current code to meet these requirements.
Run the code to make sure the logic is similar to the vba code and generate the csv files (separator is ';') and compare them to the real csv files in the output CSV folders. The results must me identical.
If it is not, analyse again the macros, adjust the code until it is a complete match.
To compare properly, you need to set the country to NZ.